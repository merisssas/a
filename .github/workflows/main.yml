name: MyXL Native (.so) Hunter

on:
  workflow_dispatch:
    inputs:
      apk_url:
        description: 'Direct Link Download APK/APKM'
        required: true

jobs:
  native_hunt:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y binutils unzip

      - name: Download & Extract APK
        run: |
          echo "â¬‡ï¸ Downloading..."
          wget -U "Mozilla/5.0" -O temp.zip "${{ inputs.apk_url }}"
          
          echo "ðŸ“¦ Extracting..."
          # Cek tipe file (APK biasa atau Bundle)
          unzip -l temp.zip > file_list.txt
          
          if grep -q "base.apk" file_list.txt; then
            echo "âœ… Tipe: APP BUNDLE"
            unzip -p temp.zip base.apk > target.apk
          else
            echo "âœ… Tipe: APK STANDAR"
            mv temp.zip target.apk
          fi
          
          # Ekstrak target.apk untuk ambil folder lib/
          unzip -q target.apk -d extracted_apk
          
      - name: HUNTING DI FILE .SO
        run: |
          echo "ðŸ” Memulai pencarian di folder lib/..."
          
          # Cari semua file .so
          find extracted_apk/lib -name "*.so" > so_list.txt
          
          if [ ! -s so_list.txt ]; then
            echo "âŒ GAGAL: Tidak ditemukan file .so (Native Libraries)."
            exit 1
          fi
          
          echo "ðŸ“‚ File .so ditemukan:"
          cat so_list.txt
          
          echo -e "\n========================================"
          echo "       HASIL DUMP STRING (.so)"
          echo "========================================"
          
          # Loop setiap file .so
          while read so_file; do
            echo -e "\nâž¡ï¸ Menganalisa: $so_file"
            
            # 1. Cari Basic Auth (Pola: Basic + spasi + karakter acak)
            #    Kita cari string "Basic " lalu ambil konteksnya
            strings "$so_file" | grep -i "Basic " | head -n 5
            
            # 2. Cari Secret Key (Pola: String panjang acak 60-150 char)
            #    Kita filter string yang panjangnya > 60 karakter dan < 200 karakter
            #    Hanya ambil yang isinya huruf angka (alphanumeric)
            strings "$so_file" | awk 'length($0) > 60 && length($0) < 200' | grep -E '^[a-zA-Z0-9]+$' > candidates.txt
            
            if [ -s candidates.txt ]; then
               echo "   [!] KANDIDAT SECRET KEY DITEMUKAN:"
               cat candidates.txt
            fi
            
            # 3. Cari Header Spesifik (X-Data, X-Signature)
            #    Jika file ini mengandung string ini, kemungkinan besar kuncinya ada di file ini
            if strings "$so_file" | grep -q -E "X-Data|X-Signature|Ax-Api-Signature"; then
               echo "   [***] FILE INI MENGANDUNG LOGIC ENKRIPSI (Target Utama!)"
            fi
            
          done < so_list.txt

