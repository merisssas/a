name: MyXL Native (.so) Hunter (v2 - Bundle Support)

on:
  workflow_dispatch:
    inputs:
      apk_url:
        description: 'Direct Link Download APK/APKM'
        required: true

jobs:
  native_hunt:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y binutils unzip

      - name: Download & Extract ALL APKs
        run: |
          echo "â¬‡ï¸ Downloading..."
          wget -U "Mozilla/5.0" -O temp_download.zip "${{ inputs.apk_url }}"
          
          # Buat folder kerja
          mkdir -p raw_container
          mkdir -p extracted_apk
          
          echo "ðŸ“¦ Membongkar Container..."
          # Coba unzip file download (siapa tau isinya banyak APK)
          if unzip -q temp_download.zip -d raw_container; then
             echo "   -> Sukses unzip container."
          else
             echo "   -> Gagal unzip (Mungkin ini APK Standar), memindahkan file..."
             mv temp_download.zip raw_container/target.apk
          fi
          
          # Cari apakah ada file .apk di dalam hasil unzip tadi?
          APK_COUNT=$(find raw_container -name "*.apk" | wc -l)
          
          if [ "$APK_COUNT" -gt 0 ]; then
             echo "âœ… Ditemukan $APK_COUNT file APK (Bundle/Split detected)."
             echo "   -> Mengekstrak SEMUA APK untuk mencari library..."
             # Ekstrak setiap file .apk yang ditemukan ke folder extracted_apk
             find raw_container -name "*.apk" -exec unzip -q -o {} -d extracted_apk \;
          else
             echo "âœ… Tipe: APK Standar (Single File)"
             # Jika tidak ada .apk di dalam (karena file download itu sendiri adalah APK)
             unzip -q -o raw_container/target.apk -d extracted_apk
          fi
          
      - name: HUNTING DI FILE .SO
        run: |
          echo "ðŸ” Memulai pencarian file .so..."
          
          # Cari file .so DI MANA SAJA (Recursive), jangan hanya di folder lib/
          find extracted_apk -name "*.so" > so_list.txt
          
          if [ ! -s so_list.txt ]; then
            echo "âŒ GAGAL: Tidak ditemukan file .so (Native Libraries) sama sekali."
            echo "   Pastikan link download benar (APKM/APK) dan bukan XAPK Installer aneh."
            exit 1
          fi
          
          echo "ðŸ“‚ File .so ditemukan:"
          cat so_list.txt
          
          echo -e "\n========================================"
          echo "       HASIL DUMP STRING (.so)"
          echo "========================================"
          
          # Loop setiap file .so
          while read so_file; do
            echo -e "\nâž¡ï¸ Menganalisa: $so_file"
            
            # 1. Cari Basic Auth (Pola: Basic + spasi + karakter acak)
            strings "$so_file" | grep -i "Basic " | head -n 5
            
            # 2. Cari Secret Key (Pola: String panjang acak 60-150 char)
            #    Filter: panjang 60-150, hanya huruf/angka
            strings "$so_file" | awk 'length($0) > 60 && length($0) < 200' | grep -E '^[a-zA-Z0-9]+$' > candidates.txt
            
            if [ -s candidates.txt ]; then
               echo "   [!] POTENSI SECRET KEY (Cek manual satu per satu):"
               cat candidates.txt
            fi
            
            # 3. Cari Indikator Enkripsi
            #    Mencari jejak header myXL
            if strings "$so_file" | grep -q -E "X-Data|X-Signature|Ax-Api-Signature|mU1Y4n1"; then
               echo "   [***] JACKPOT! FILE INI BERISI LOGIC ENKRIPSI myXL!"
            fi
            
            # 4. Cari Potongan Key Lama (Siapa tau masih ada sisa-sisa)
            if strings "$so_file" | grep -q "mU1Y4n1"; then
               echo "   [***] DITEMUKAN POTONGAN KEY LAMA DI SINI!"
            fi
            
          done < so_list.txt
