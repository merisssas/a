name: MyXL Ultimate Dump (.so)

on:
  workflow_dispatch:
    inputs:
      apk_url:
        description: 'Direct Link Download APK/APKM'
        required: true

jobs:
  dump_everything:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y binutils unzip

      - name: Download & Extract ALL APKs
        run: |
          echo "â¬‡ï¸ Downloading..."
          wget -U "Mozilla/5.0" -O temp_download.zip "${{ inputs.apk_url }}"
          
          mkdir -p raw_container
          mkdir -p extracted_apk
          
          echo "ðŸ“¦ Membongkar Container..."
          if unzip -q temp_download.zip -d raw_container; then
             echo "   -> Sukses unzip container."
          else
             echo "   -> Gagal unzip, anggap APK Standar."
             mv temp_download.zip raw_container/target.apk
          fi
          
          APK_COUNT=$(find raw_container -name "*.apk" | wc -l)
          
          if [ "$APK_COUNT" -gt 0 ]; then
             echo "âœ… Ditemukan $APK_COUNT file APK. Mengekstrak SEMUA..."
             find raw_container -name "*.apk" -exec unzip -q -o {} -d extracted_apk \;
          else
             echo "âœ… Tipe: APK Standar."
             unzip -q -o raw_container/target.apk -d extracted_apk
          fi
          
      - name: DUMP SEMUA STRING
        run: |
          echo "ðŸ” Memulai proses DUMPING..."
          touch HASIL_DUMP.txt
          
          # Cari semua file .so
          find extracted_apk -name "*.so" > so_list.txt
          
          if [ ! -s so_list.txt ]; then
            echo "âŒ GAGAL: Tidak ditemukan file .so."
            exit 1
          fi
          
          echo "Daftar File yang akan di-dump:"
          cat so_list.txt
          
          # Loop dan sedot isinya
          while read so_file; do
            echo "Processing: $so_file"
            echo "========================================================" >> HASIL_DUMP.txt
            echo "FILE: $so_file" >> HASIL_DUMP.txt
            echo "========================================================" >> HASIL_DUMP.txt
            
            # AMBIL SEMUA STRING (Minimal 10 karakter agar sampah hilang)
            strings -n 10 "$so_file" >> HASIL_DUMP.txt
            
            echo -e "\n\n" >> HASIL_DUMP.txt
          done < so_list.txt
          
          echo "âœ… Selesai! Semua string tersimpan di HASIL_DUMP.txt"

      - name: PREVIEW CEPAT (Untuk Chat)
        run: |
          echo "================================================="
          echo " PREVIEW: STRING PANJANG (Kandidat Secret Key)"
          echo "================================================="
          # Tampilkan di log string yang panjangnya > 80 karakter (biasanya Key itu 100+ char)
          # Kita filter hanya huruf & angka agar rapi
          grep -E "^[a-zA-Z0-9]{80,200}$" HASIL_DUMP.txt | grep -v "0123456789" | head -n 50
          
          echo "================================================="
          echo " PREVIEW: BASIC AUTH"
          echo "================================================="
          grep -i "Basic " HASIL_DUMP.txt | head -n 20

      - name: Upload Artifact (Download Hasilnya Disini)
        uses: actions/upload-artifact@v4
        with:
          name: full-string-dump
          path: HASIL_DUMP.txt
